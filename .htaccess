# CI-Inbox Root .htaccess
# Redirect to setup wizard or application

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Security: Deny access to sensitive directories
    RewriteRule ^(vendor|database|logs|data)/ - [F,L]

    # Check if setup is needed
    RewriteCond %{REQUEST_URI} !^/src/public/setup/
    RewriteCond %{DOCUMENT_ROOT}/.env !-f
    RewriteRule ^(.*)$ src/public/setup/index.php [L]

    # URL Cleanup: Strip /src/public/ from URLs if present (IONOS hosting fix)
    # This redirects browser URLs like /src/public/login.php to /login.php
    RewriteCond %{THE_REQUEST} \s/src/public/(.+)\s [NC]
    RewriteRule ^ /%1 [R=301,L]

    # Internal Rewrite: Route all requests to src/public/
    RewriteCond %{REQUEST_URI} !^/src/public/
    RewriteRule ^(.*)$ src/public/$1 [L]
</IfModule>

# Security: Protect sensitive directories
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Prevent access to sensitive files
RedirectMatch 403 /\.env
RedirectMatch 403 /composer\.json
RedirectMatch 403 /composer\.lock
RedirectMatch 403 /vendor/
RedirectMatch 403 /database/
RedirectMatch 403 /logs/
RedirectMatch 403 /tests/

# Disable directory listing
Options -Indexes
