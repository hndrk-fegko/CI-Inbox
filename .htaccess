# CI-Inbox Root .htaccess
# Installation Mode - Routes to Setup Wizard
# 
# This file will be REPLACED by src/public/setup/index.php after successful installation
# with a production .htaccess that blocks /setup and /install routes.

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Setup/Install Routes (Installation Mode)
    # Direct all /install, /setup, / requests to setup wizard
    
    # Route / to setup if .env is missing or invalid
    RewriteCond %{DOCUMENT_ROOT}/.env !-f [OR]
    RewriteCond %{DOCUMENT_ROOT}/vendor/autoload.php !-f
    RewriteRule ^$ src/public/setup/index.php [L]
    
    # Route /install to setup
    RewriteRule ^install/?$ src/public/setup/index.php [L]
    
    # Route /setup to setup
    RewriteRule ^setup/?$ src/public/setup/index.php [L]
    RewriteRule ^setup/(.*)$ src/public/setup/$1 [L]
    
    # Allow direct access to vendor auto-install endpoint
    RewriteRule ^src/public/setup/(.*)$ src/public/setup/$1 [L]
    
    # Production Routes (will be overwritten after installation)
    # Route all other requests to src/public/
    RewriteRule ^(.*)$ src/public/$1 [L]
</IfModule>

# Security: Deny access to sensitive files
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Deny access to composer files
<FilesMatch "(composer\.(json|lock)|package\.json)$">
    Order allow,deny
    Deny from all
</FilesMatch>
